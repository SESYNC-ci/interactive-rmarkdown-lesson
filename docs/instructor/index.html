<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="lesson_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="lesson_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="lesson_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="lesson_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="lesson_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="lesson_files/navigation-1.1/tabsets.js"></script>
<link href="lesson_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="lesson_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">




</div>


<div id="smart-and-interactive-documents" class="section level1">
<h1>Smart and Interactive Documents</h1>
<p>Lesson 9 with <em>Kelly Hondula</em></p>
<div id="how-smart" class="section level2">
<h2>How Smart?</h2>
<p>The reproducible pipeline under construction begins with open data, uses scripts to perform analyses and create visualizations, and ideally ends in a published write-up.</p>
<p><a href="https://cran.r-project.org/package=rmarkdown">rmarkdown</a> merges code and documentation, allowing you to create automatic reports that include the results of computations and visualizations created on-the-fly.</p>
</div>
<div id="how-interactive" class="section level2">
<h2>How Interactive?</h2>
<div class="notes">
<p>Rather than rendering to a static document, RStudio lets you easily inject <a href="https://cran.r-project.org/package=shiny">shiny</a> input and output widgets to documents constructed with RMarkdown. These widgets can accept user input through forms, menus, and sliders, and cause corresponding tables, plots, and other graphical output to dynamically update.</p>
</div>
<p>Interactive documents require connection to a live R process, which any user running RStudio can provide, but so can hosting services like <a href="http://www.shinyapps.io/" class="uri">http://www.shinyapps.io/</a>.</p>
</div>
<div id="lesson-objectives" class="section level2">
<h2>Lesson Objectives</h2>
<ol style="list-style-type: decimal">
<li>Start with “dumb” documents and the basics of Markdown.</li>
<li>Envision an efficient, one-click pipeline with RMarkdown.</li>
<li>Create an interactive document with Shiny.</li>
</ol>
</div>
<div id="markdown" class="section level2">
<h2>Markdown</h2>
<p>Markdown exists outside of the R environment. Like R, it is both a language and an interpreter.</p>
<ol style="list-style-type: decimal">
<li><p>It is a <strong>language</strong> with special characters and a syntax that convey formatting instructions inside text files.</p></li>
<li><p>The accompanying <strong>interpreter</strong> reads text files and outputs one of several types of formatted documents (e.g Word, PDF, and HTML).</p></li>
</ol>
</div>
<div id="rmarkdown" class="section level2">
<h2>RMarkdown</h2>
<p>The <a href="https://cran.r-project.org/package=rmarkdown">rmarkdown</a> package bundles the formatting ability of Markdown with the ability to send embedded code to an R interpreter and capture the result.</p>
</div>
<div id="seeing-is-believing" class="section level2">
<h2>Seeing is Believing</h2>
<p>The handout for this lesson <em>is</em> this lesson. The lesson’s <code>.Rmd</code> worksheet is the RMarkdown source for this document (with a few ommissions for you to fill in). Open it and find this line of code:</p>
<pre class="r"><code>data.frame(counts = c(4, 5, 6))</code></pre>
<pre><code>##   counts
## 1      4
## 2      5
## 3      6</code></pre>
<div class="notes">
<p>The output <em>is not in the source</em>—it was “knit” into the rendered output. Press the “Knit” button in RStudio to generate the single-page view of this lesson. As we proceed, fill in the <code>...</code> areas of your worksheet, and press the “Knit” button to verify the output.</p>
</div>
</div>
<div id="markdown-syntax" class="section level2">
<h2>Markdown Syntax</h2>
<p>Before getting to the good stuff, a quick introduction to “dumb” Markdown formatting.</p>
</div>
<div id="preformatted-text" class="section level2">
<h2>Preformatted Text</h2>
<p>Text fenced by “```” is left untouched by the Markdown interpreter, usually for the purpose of displaying code. Everything else is formatted according to a light-weight syntax.</p>
<pre><code>The *emphasis* indicated by asterisks here does not become
italicized, as it would outside a &quot;code fence&quot;.</code></pre>
<div class="notes">
<p>That’s three backtick characters, found next to the “1” on QWERTY keyboards, above and below the text.</p>
</div>
</div>
<div id="bulleted-lists-preformatted" class="section level2">
<h2>Bulleted Lists (preformatted)</h2>
<p>Sequential lines beginning with “-” are grouped into a bulleted list. The following preformatted text shows the syntax.</p>
<pre><code>- SQL
- Python
- R</code></pre>
<div class="notes">
<p>Without a code fence (which is not present in your worksheet), the chunk of text above will be rendered as a bulleted list. All the sections with “(preformatted)” in the online lesson are paired with a section in your worksheet for you to complete and then <code>knit</code>.</p>
</div>
</div>
<div id="numbered-lists-preformatted" class="section level2">
<h2>Numbered Lists (preformatted)</h2>
<p>Sequential lines beginning with a number are grouped into a numbered list. The actual number you use is irrelevant.</p>
<pre><code>6. SQL
1. Python
5. R</code></pre>
</div>
<div id="tables-preformatted" class="section level2">
<h2>Tables (preformatted)</h2>
<p>Separate text with vertical bars (<code>|</code>) to indicate columns of a table and hyphens (<code>-</code>) to mark the beginning of a table or to separate the header row.</p>
<pre><code>id | treatment
---|----------
1  | control
2  | exclosure</code></pre>
</div>
<div id="configuration" class="section level2">
<h2>Configuration</h2>
<p>Text at the top of a Markdown file and fenced by <code>---</code> stores configuration. Variables set here can, for example, change the type of document produced.</p>
<pre><code>---
output: html_document
---</code></pre>
<p>Change the output variable to <code>ioslides_presentation</code> and knit again to generate output formatted as a slideshow.</p>
</div>
<div id="headers-preformatted" class="section level2">
<h2>Headers (preformatted)</h2>
<p>Default formatting for an <code>html_document</code> differs in some cases from an <code>ioslides_presentation</code>. The use of <code>#</code> to indicate a hierarchy of heading sizes serves an additional purpose in a slideshow.</p>
<pre><code># The Biggest Heading
## The Second Biggest Heading
### The Third Biggest Heading</code></pre>
</div>
<div id="r-markdown-preformatted" class="section level2">
<h2>R + Markdown (preformatted)</h2>
<p>The <a href="https://cran.r-project.org/package=rmarkdown">rmarkdown</a> package evaluates the R expressions within a code fence and inserts the result into the output document. To send these “code chunks” to the R interpreter, append <code>{r}</code> to the upper fence.</p>
<pre><code>```{r}
seq(1, 10)
```</code></pre>
</div>
<div id="chunk-options-preformatted" class="section level2">
<h2>Chunk Options (preformatted)</h2>
<p>Each code chunk runs under options specified globally or within the <code>{r ...}</code> expression. The option <code>echo = FALSE</code> would cause the output to render without the input. The option <code>eval = FALSE</code>, would prevent evaluation and output rendering.</p>
<pre><code>```{r echo = FALSE}
seq(1, 10)
```</code></pre>
</div>
<div id="chunk-labels-preformatted" class="section level2">
<h2>Chunk Labels (preformatted)</h2>
<p>The first entry after <code>{r</code> will be interpretted as a chunk label if it is not setting an option. Chunk options are specified after the optional label and separated by commas. Labels do not show up in the document—we’ll have other uses for them.</p>
<pre><code>```{r does_not_run, eval = FALSE}
seq(1, 10)
```</code></pre>
</div>
<div id="reproducible-pipeline" class="section level2">
<h2>Reproducible Pipeline</h2>
<p>A pipeline might rely on several scripts that separately aquire data, tidy it, fit or run models, and validate results. Embedding calls to those external scripts is one way to create a one-click pipeline.</p>
</div>
<div id="sourced-pipeline-preformatted" class="section level2">
<h2>Sourced Pipeline (preformatted)</h2>
<p>The <code>source</code> function in R includes the contents of a separate file in the current code chunk. The entire script is evaluated in the current environment.</p>
<pre><code>```{r load_data, echo = FALSE}
source(&#39;worksheet-9.R&#39;)
```</code></pre>
<p>The lesson’s <code>.R</code> worksheet is an R script creating a <code>rodents</code> data frame, which “sourcing” makes available to following lines as well as subsequent code chunks.</p>
</div>
<div id="sourced-pipeline-preformatted-1" class="section level2">
<h2>Sourced Pipeline (preformatted)</h2>
<pre><code>```{r bar_plot}
library(ggplot2)
ggplot(rodents, aes(x = species_id, y = count)) +
  geom_bar(stat = &#39;identity&#39;)
```</code></pre>
<div class="notes">
<p>If your entire pipeline can be scripted in R, you <em>could</em> embed the entire analysis in code chunks within your write-up. The better practice demonstrated here is “modularizing” your analysis by splitting it into isolated scripts, and then using an <a href="https://cran.r-project.org/package=rmarkdown">rmarkdown</a> document to execute the pipeline.</p>
</div>
</div>
<div id="non-sourced-pipelines-preformatted" class="section level2">
<h2>Non-sourced pipelines (preformatted)</h2>
<p>The code interpreter is not limited to R. Several interpreters, including <code>python</code> and <code>sql</code>, can be used for code written directly into a code chunk.</p>
<pre><code>```{python}
greeting = &#39;Hello, {}!&#39;
print(greeting.format(&#39;world&#39;))
```</code></pre>
</div>
<div id="non-sourced-pipelines-preformatted-1" class="section level2">
<h2>Non-sourced pipelines (preformatted)</h2>
<p>Access to your operating system shell, for example the Linux <code>bash</code> interpreter, provides a way to run any scripted pipeline step.</p>
<pre><code>```{bash}
python -c &#39;import os; print(&quot;Hello, {}!&quot;.format(os.environ[&quot;USER&quot;]))&#39;
```</code></pre>
<div class="notes">
<p>An important distinction between sourced and non-sourced pipelines is the inabillity of interpreters other than R to return R objects. By using <code>source</code>, an R script is run in the current R session, which provides an easy way to pass data between scripts. Typically, file-based input and output is necessary for multi-lingual pipelines. For Python, however, the <a href="https://rstudio.github.io/reticulate/articles/r_markdown.html">reticulate</a> package provides a bi-directional interface.</p>
</div>
</div>
<div id="efficient-pipelines-preformatted" class="section level2">
<h2>Efficient Pipelines (preformatted)</h2>
<div class="notes">
<p>There is no reason to run every step of a pipeline after making changes “downstream”. Like more comprehensive software for automating pipelines, <a href="https://cran.r-project.org/package=rmarkdown">rmarkdown</a> includes the notion of tracking dependencies and caching results. Cached code chunks are not re-evaluated unless the content of the code changes.</p>
</div>
<p>Enable <code>cache</code> in the <code>setup</code> chunk to turn off re-evaluation of any code chunk that has not been modified since the last <code>knit</code>.</p>
<pre><code>```{r setup, include = FALSE}
library(knitr)
opts_chunk$set(message = FALSE, warning = FALSE, out.width = &#39;75%&#39;, cache = TRUE)
```</code></pre>
</div>
<div id="cache-preformatted" class="section level2">
<h2>Cache (preformatted)</h2>
<p>Render the worksheet again to create a cache for each code chunk, <em>and then</em> modify your <code>bar_plot</code> chunk to show species’ weights and render again. The “slow” <code>load_data</code> chunk zips right by, using its cache, but the plot will change.</p>
<pre><code>```{r bar_plot}
library(ggplot2)
ggplot(rodents, aes(x = species_id, y = weight)) +
  geom_bar(stat = &#39;identity&#39;)
```</code></pre>
</div>
<div id="cache-dependencies-preformatted" class="section level2">
<h2>Cache Dependencies (preformatted)</h2>
<p>With the <code>dependson</code> option, even an unmodified chunk will be re-evaluated if a dependency runs.</p>
<pre><code>```{r clean_bar_plot, dependson = &#39;load_data&#39;}
ggplot(rodents, aes(x = species_id, y = weight)) +
  geom_bar(stat = &#39;identity&#39;)
```</code></pre>
<div class="notes">
<p>Add the above new chunk with <code>dependson = 'load_data'</code> so it updates if and only if the load_data chunk is executed. Knit the document and compare the <code>bar_chart</code> and <code>clean_bar_chart</code> outputs; at this point <code>bar_plot</code> and <code>clean_bar_plot</code> should be identical. Now make <code>load_data</code> clean the data, then <code>knit</code> again and compare the plots.</p>
</div>
<pre><code>```{r load_data, echo = FALSE}
source(&#39;worksheet-9.R&#39;)
rodents &lt;- subset(rodents, !is.na(weight))
```</code></pre>
<div class="notes">
<p>The updated result of <code>clean_bar_plot</code> now reflects the cleaning operation on the <code>rodents</code> data frame. But the <code>bar_plot</code> chunk simply loaded results from its cache, because the dependency was not explicit.</p>
<p>Note that the second plot will execute when the <code>load_data</code> <em>chunk</em> changes, but this chunk contains a call to <code>source</code>. The <code>rodents</code> variable could change if the code in the sourced file is updated, but this would <em>not</em> trigger re-generation of the second plot!</p>
</div>
</div>
<div id="external-dependencies-preformatted" class="section level2">
<h2>External Dependencies (preformatted)</h2>
<p>By adding the option <code>cache.extra</code>, any trigger can be given to force re-evaluation of an unmodified chunk. In combination with the <code>md5sum</code> function from the <code>tools</code> package, this permits external file dependencies.</p>
<pre><code>```{r setup}
library(knitr)
library(tools)
opts_chunk$set(message = FALSE, warning = FALSE, out.width = &#39;75%&#39;, cache = TRUE)
```</code></pre>
<pre><code>```{r load_data, echo = FALSE, cache.extra = md5sum(&#39;worksheet-9.R&#39;)}
source(&#39;worksheet-9.R&#39;)
rodents &lt;- subset(rodents, !is.na(weight))
```</code></pre>
<div class="notes">
<p>A change to the <code>rodents</code> data frame, for example by dropping NAs at a more appropriate data cleaning step in the sourced <code>.R</code> script, will now be reflected in the <code>clean_bar_plot</code> result with <code>dependson = load_data</code>, but not the <code>bar_plot</code> plot.</p>
<pre><code>  summarize(count = n(), weight = mean(weight, na.rm = TRUE))</code></pre>
</div>
</div>
<div id="interact-with-shiny" class="section level2">
<h2>Interact with Shiny</h2>
<p>Enough about “smart” documents, what about “interactive”?</p>
</div>
<div id="what-is-shiny" class="section level2">
<h2>What is Shiny?</h2>
<p>Shiny is a web application framework for R that allows you to create interactive apps for exploratory data analysis and visualization, to facilitate remote collaboration, share results, and <a href="http://shiny.rstudio.com/gallery/">much more</a>.</p>
<pre><code>---
output: ioslides_presentation
runtime: shiny_prerendered
---</code></pre>
</div>
<div id="input-and-output" class="section level2">
<h2>Input and Output</h2>
<p>The <a href="https://cran.r-project.org/package=shiny">shiny</a> package provides functions that generate two key types of content in the output document: input and output “widgets”. The user can change the input and the output, e.g. a table or plot, dynamically responds.</p>
<p><img src="images/arrows3.png" width="100%" /></p>
<div class="notes">
<p>Writing an interactive document requires careful attention to how your input and output objects relate to each other, i.e. knowing what actions will initiate what sections of code to run at what time.</p>
</div>
</div>
<div id="input-objects-preformatted" class="section level2">
<h2>Input Objects (preformatted)</h2>
<p>Input objects collect information from the user and save it into a list variable called <code>input</code>. The value for any given named entity in the list updates when the user changes the input widget with the corresponding name.</p>
<pre><code>```{r echo = FALSE}
selectInput(&#39;pick_species&#39;,
  label = &#39;Pick a Species&#39;,
  choices = unique(species[[&#39;id&#39;]]))
```</code></pre>
<div class="notes">
<p>RStudio has a nice <a href="http://shiny.rstudio.com/gallery/widget-gallery.html">gallery</a> of input objects and accompanying sample code.</p>
</div>
</div>
<div id="contexts-preformatted" class="section level2">
<h2>Contexts (preformatted)</h2>
<p>As shown in the figure above, an interactive document runs R code in multiple “contexts”; for example, while rendering the document and in the connected R process running on the server. The “data” context is a special context needed for cached chunk output that we want available to the server.</p>
<pre><code>```{r load_data, echo = FALSE, cache.extra = md5sum(&#39;worksheet.R&#39;), context = &#39;data&#39;}
source(&#39;worksheet-9.R&#39;)
rodents &lt;- subset(rodents, !is.na(weight))
```</code></pre>
<p>You might have to clear (i.e. delete) the cache since we added the runtime.</p>
</div>
<div id="output-objects-preformatted" class="section level2">
<h2>Output objects (preformatted)</h2>
<p>Output objects are created in ther “server” context by several functions in the <a href="https://cran.r-project.org/package=shiny">shiny</a> package that produce a range of widgets.</p>
<pre><code>```{r context = &#39;server&#39;}
library(dplyr)
output[[&#39;ts_plot&#39;]] &lt;- renderPlot({
  animals %&gt;%
    filter(species_id == input[[&#39;pick_species&#39;]]) %&gt;%
    ggplot(aes(year)) + 
      geom_bar()
})
```</code></pre>
<pre><code>```{r echo = FALSE}
plotOutput(&#39;ts_plot&#39;)
```</code></pre>
</div>
<div id="render-functions" class="section level2">
<h2>Render Functions</h2>
<p>Key functions for creating output objects:</p>
<ul>
<li><code>renderPrint()</code></li>
<li><code>renderText()</code></li>
<li><code>renderPlot()</code></li>
<li><code>renderTable()</code></li>
<li><code>renderDataTable()</code></li>
</ul>
</div>
<div id="reactivity-preformatted" class="section level2">
<h2>Reactivity (preformatted)</h2>
<div class="notes">
<p>The output objects in an interactive document have to be understood in terms of reactivity: each one “knows” its content should react to certain changes in the environment, including to the <code>input</code> list.</p>
</div>
<p>Create additional environment-aware objects with <code>reactive()</code> from the <a href="https://cran.r-project.org/package=shiny">shiny</a> package. A useful type of reactive object for an efficient pipeline is the result of data manipulations, which can be calculated once and used multiple times.</p>
<pre><code>```{r context = &#39;server&#39;}
plot_data &lt;- reactive({
  filter(animals,
         species_id == input[[&#39;pick_species&#39;]])
})
output[[&#39;react_ts_plot&#39;]] &lt;- renderPlot({
  plot_data() %&gt;%
    ggplot(aes(year)) +
      geom_bar()
})
```</code></pre>
</div>
<div id="reactivity-preformatted-1" class="section level2">
<h2>Reactivity (preformatted)</h2>
<p>Don’t forget to include your plot in the document!</p>
<pre><code>```{r echo = FASE}
plotOutput(&#39;react_ts_plot&#39;)
```</code></pre>
<div class="notes">
<p>In the worked example, the step of filtering the <code>animals</code> data frame still only occurs once. In a scenario where the subset of animals were used for multiple computations or vizualitions, creating the reactive <code>plot_data()</code> object makes a more efficient pipeline.</p>
</div>
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<ul>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf">RStudio Cheatsheet</a></li>
<li><a href="https://shiny.rstudio.com/articles/interactive-docs.html">RStudio article on interactive documents</a></li>
<li><a href="https://shiny.rstudio.com/articles/interactive-docs.html">RStudio article on “shiny_prerendered” runtime</a></li>
<li><a href="https://rmarkdown.rstudio.com/gallery.html">RMarkdown Gallery</a></li>
</ul>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
</div>
<div id="exercise-1" class="section level2">
<h2>Exercise 1</h2>
<p>Create a table with two columns, starting with a header row with fields “Character” and “Example”. Fill in the table with rows for the special Markdown characters *, **, ^, and ~, providing an example of each.</p>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise 2</h2>
<p>Display your presentation on GitHub. Your repository on GitHub includes a free web hosting service known as GitHub Pages. Publish your worksheet there with the following steps.</p>
<ul>
<li>Remove any bits of the shiny runtime (GitHub only serves static pages).</li>
<li>Copy the HTML output file to <code>docs/index.html</code>.</li>
<li>Stage, commit &amp; push the <code>docs/index.html</code> file to GitHub.</li>
<li>On GitHub, under Settings &gt; GitHub Pages, set <code>docs/</code> as the source.</li>
</ul>
</div>
<div id="solutions" class="section level2">
<h2>Solutions</h2>
</div>
<div id="solution-1" class="section level2">
<h2>Solution 1</h2>
<table>
<thead>
<tr class="header">
<th>character</th>
<th>format</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>*</td>
<td><em>italics</em></td>
</tr>
<tr class="even">
<td>**</td>
<td><strong>bold</strong></td>
</tr>
<tr class="odd">
<td>^</td>
<td>super<sup>script</sup></td>
</tr>
<tr class="even">
<td>~~</td>
<td><del>strikethrough</del></td>
</tr>
</tbody>
</table>
</div>
<div id="solution-2" class="section level2">
<h2>Solution 2</h2>
<p>Just follow the instructions!</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
